<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>

    <link rel="icon" href="../Assets/Imagens/favicon.ico" type="image/x-icon">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
    <script src="../Funcionalidades.js"></script>
    <script src="../Gráficos.js"></script>
</head>

<body onclick="fecharPopup(); fecharAtualizacoes(); fecharLogout(); fecharConfiguracoes();">

    <!-- Sidebar -->
    <div class="headers">
        <section id="sidebar" class="sidebar">
            <img src="../assets/imagens/Ômega Fish.png" alt="">


            <li class="bx bx-home-alt icon" onclick="window.location.href = '../DashboardHome.html';">
                <span class="texto">Dashboard</span>
            </li>
            

            <li class="bx bx-notepad"  onclick="exibirPopup(); event.stopPropagation();"> <span class="texto">Alertas</span> </li>
            
            <li class="bx bx-refresh" onclick="exibirAtualizacoes(); event.stopPropagation();"> <span class="texto">Atualizações</span> </li>

            <div class="sidebar-end">
                <li class="bx bx-cog" onclick="exibirConfiguracoes(); event.stopPropagation();"> <span class="texto">Configurações</span> </li>
                <li class="bx bx-user-circle" onclick="exibirLogout(); event.stopPropagation();"> <span class="texto">Logout</span></li>
        </section>
        <div id="corpo" class="corpo">
            <section class="header">
                <li id="toggle" class="bx bx-list-ul toggle"></li>
                <h3 style="white-space: nowrap;">Dashboard</h3>
                <h3>-</h3>
                <h3 style="white-space: nowrap;">Câmara 1</h3>
                <div class="header-end">

                    <li onclick="AtivarDesativarFS()" class='bx bx-fullscreen'></li>
                    <h3>Luana Oliveira</h3>
                    
                </div>
            </section>
            <section id="conteudo" class="div_pai">
                
                <div class="primeira_div">
                    <div class="KPIS">
                        <div class="kpi1">
                            <div class="titulo">
                                <h1> <span style="color: #00C3FF;">Temperatura</span> em Tempo real</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/ferramenta-termometro.png " alt=""> <h2 id="mensagem_temperatura"></h2></div>
                        
                        </div>
                        <div class="kpi2">
                            <div class="titulo">
                                <h1><span style="color: #00C3FF;">Umidade</span> em Tempo real</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/agua.png " alt=""> <h2 id="mensagem_umidade"></h2></div>
                        </div>
                        <div class="kpi3">
                            <div class="titulo">
                                <h1><span style="color: #00C3FF;">Último</span> Alerta Registrado</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/relogio.png " alt=""> <h2 id="mensagem_tempo"> 5 Dias</h2></div>
                        </div>
                    </div>
                    <div class="conteudo">
                        <div class="container">
                            <div class="tab">
    
                                <div class="header_tab">
                                    <div class="titulo">
                                        <h3>Temperatura</h3>
                                    </div>
    
                                    <div class="botões">
                                        <button class="tablinks active primeiro_botao"
                                            onclick="openTab(event, 'chartTab1')">Tempo Real</button>
                                        <button class="tablinks" onclick="openTab(event, 'chartTab2')">Última Hora</button>
                                        <button class="tablinks ultimo_botao" onclick="openTab(event, 'chartTab3')">Último
                                            Dia</button>
                                    </div>
                                </div>
    
    
                                <div id="chartTab1" class="tabcontent" style="display: block;">
                                    <canvas id="Temp_TempoReal"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Segundos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab2" class="tabcontent">
                                    <canvas id="Temp_Semana"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Minutos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab3" class="tabcontent">
                                    <canvas id="Temp_Mes"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Horas)</span>
                                    </div>
                                </div>
    
                            </div>
                        </div>
    
                        <div class="container">
    
                            <div class="tab">
                                <div class="header_tab">
                                    <div class="titulo">
                                        <h3>Umidade</h3>
                                    </div>
    
                                    <div class="botões">
                                        <button class="tablinks2 active primeiro_botao"
                                            onclick="openTab2(event, 'chartTab4')">Tempo Real</button>
                                        <button class="tablinks2" onclick="openTab2(event, 'chartTab5')">Última Hora</button>
                                        <button class="tablinks2 ultimo_botao" onclick="openTab2(event, 'chartTab6')">Último
                                            Dia</button>
                                    </div>
                                </div>
    
    
    
                                <div id="chartTab4" class="tabcontent2" style="display: block;">
                                    <canvas id="Umid_TempoReal"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Segundos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab5" class="tabcontent2">
                                    <canvas id="Umid_Semana"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Minutos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab6" class="tabcontent2">
                                    <canvas id="Umid_Mes"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Horas)</span>
                                    </div>
                                </div>
                                
    
                            </div>
                        </div>
                        
                    </div>
                    <div class="ultimo_grafico">
                        <div class="titulo">
                            <h1>Temperatura e Umidade Ao Longo do Ano </h1>
                        </div>
                        <canvas id="ultimo_grafico" width="900" height="200"></canvas>
                      </div>
                      
                      
                        
                      
                
                </div>
                <div class="segunda_div">
                    <div class="div_pai_container">

                
                        <div class="chartCard1">
                            <div class="container_chart">
                                <div class="chartBox">
                                    <div class="titulo">
                                        <h1>Medidor de Atividades <spans style="color: #00C3FF;">Críticas</spans></h1>
                                    </div>
                                        

                                    <div id="container"></div>
                                    <div class="titulo_chart">
                                    <h3 id="id_status_temperatura"></h3>
                                </div>
                                <div class="descricao_chart">
                                    <h5 style="color: #03F44E;">&#x2B24; Controlado </h5>
                                    <h5 style="color: yellow;">&#x2B24; Instável</h5>
                                    <h5 style="color: red;">&#x2B24; Emergência</h5>
                                </div>
                                <div class="legenda_chart">
                                    <h5 style="color: #03F44E;">0°C ~ 2°C </h5> 
                                    <h5 style="color: yellow;"> 2°C ~ 4°C </h5> 
                                    <h5 style="color: red;">4°C ~ 8°C</h5>
                                </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="chartCard2">
                            <div class="container_chart">
                    
                                <div class="chartBox">
                                    <div class="titulo">
                                        <h1>Medidor de Atividades <span style="color: #00C3FF;">Críticas</span></h1>
                                    </div>


                                  <div id="container2"></div>
                                  <div class="titulo_chart">
                                    <h3 id="id_status_umidade"></h3>
                                </div>
                                <div class="descricao_chart">
                                    <h5 style="color: #03F44E; ">&#x2B24; Controlado </h5>
                                    <h5 style="color: yellow;">&#x2B24; Instável</h5>
                                    <h5 style="color: red;">&#x2B24; Emergência</h5>
                                </div>
                                <div class="legenda_chart2">
                                    <h5 style="color: #03F44E;">100% ~ 50% </h5> 
                                    <h5 style="color: yellow;"> 50% ~ 40% </h5> 
                                    <h5 style="color: red;">40% ~ 0%</h5>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                    
                
                
            </section>

        </div>


    </div>
    <div id="popup" class="popup">
        <h2>Notificações</h2>
        <div class="alertas">
            <div class="instavel">
                <img src="../assets/imagensdash/atencao.png">
                <div>
                    <h4>Instabilidade - Câmara 2</h4>
                    <p>Temperatura: 3°C, Umidade: 45%</p>
                    <p>Data: 08/05/2024 - 09:50:45</p>
                </div>
            </div>
            <div class="emergencia">
                <img src="../assets/imagensdash/alarm.png">
                <div>
                    <h4>Emergência - Câmara 2</h4>
                    <p>Temperatura: 5°C, Umidade: 20%</p>
                    <p>Data: 08/05/2024 - 15:57:44</p>
                </div>
            </div>
        </div>
    </div>
    <div id="atualizacoes" class="atualizacoes">
        <h2>Atualizações</h2>
        <p>Ainda não tivemos nenhuma atualização...</p>
    </div>
    <div id="logout" class="logout">
        <h2>Tem Certeza que deseja sair da conta?</h2>
        <div class="botoes_logout">
            <button class="botao2" onclick="fecharLogout()">Cancelar</button>
            <a href="../../login.html"><button class="botao1">Sair</button></a>
        </div>
        
        
    </div>
    <div id="configuracoes" class="configuracoes">
        <div class="box_config">
        <h2>Configurações</h2> <br>
        <p>Parte em Desenvolvimento...</p>
        </div>
        
    </div>
    

</body>

</html>

<script>

    //Variáveis de Controle
    var tempo = 5

    var temperatura_gauge = 0
    var umidade_gauge = 0

    var status_temperatura = 0
    var status_umidade = 0

    var unidade_tempo = `Dias`

    function buscarDadosMes() {
        var idCamaraCaminhao = sessionStorage.getItem("idCamara")
        fetch(`http://localhost:3333/medidas/mes/${idCamaraCaminhao}`).then(res => {
            res.json().then(response => {
                plotarGrafico(response)
            })
        })
    }

    var lista_Temp = []
    var lista_Umid = []
    var lista_HoraColeta = []
    function plotarGrafico(dados) {
        console.log(dados)
        for (var i = 0; i < dados.length; i++) {
            lista_Temp.push(dados[i].SensorTemp)
            lista_Umid.push(dados[i].SensorUmid)
            lista_HoraColeta.push(dados[i].HoraColeta)
        }

        const ctx7 = document.getElementById('ultimo_grafico');
        new Chart(ctx7, {
            type: 'line',
            data: {
                labels: lista_HoraColeta,
                datasets: [{
                    label: 'Umidade',
                    data: lista_Umid,
                    borderColor: 'rgb(0, 195, 255)',
                    backgroundcolor: 'rgb(13, 14, 43)',
                    lineTension: 0.3,
                    yAxisID: 'y',
                    
                },
                {
                    label: 'Temperatura',
                    data: lista_Temp,
                    borderColor: 'rgb(255, 151, 46)',
                    backgroundcolor: 'rgb(13, 14, 43)',
                    lineTension: 0.3,
                    yAxisID: 'y1',
                }

                ]
            },
            options: {
                
                scales: {
                    y: {
                        ticks: {
                            count: 5, // Defina o número desejado de labels no eixo y
                            callback: function (value, index, values) {
                                return value + '%'; // Adiciona o símbolo de porcentagem
                            },
                            padding: 15
                        },
                        position: 'left',
                        grid: {
                    
                        },
                        yAxisID: 'y',
                    },

                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: {
                            color: 'rgb(35, 35, 35)', // Cor das linhas de grade do eixo y
                        },
                        yAxisID: 'y1',
                    }
                    ,

                    x: {
                        grid: {
                            color: 'rgb(35, 35,35)', // Cor das linhas de grade do eixo x
                        }
                    }
                }
            }
        });
    
    }

    var temperatura = 0;
    var umidade = 0;
    function buscarDadosReal() {
        var idCamaraCaminhao = sessionStorage.getItem("idCamara")
        fetch(`http://localhost:3333/camaras/${idCamaraCaminhao}/dados`).then((res) => {
            res.json().then((response) => {
                temperatura = response[0].SensorTemp
                umidade = response[0].SensorUmid

                mensagem_temperatura.innerHTML = `${temperatura}°C`
                mensagem_umidade.innerHTML = `${umidade}%`
                mensagem_tempo.innerHTML = `${tempo} ${unidade_tempo}`

                montarGauge(temperatura, umidade)

                if(temperatura <= 2) {
                    id_status_temperatura.innerHTML = `<h4 style="color:#03F44E; margin-top: 45px;">Controlado</h4>`
                } else if(temperatura <= 4) {
                    id_status_temperatura.innerHTML = `<h4 style="color:yellow; margin-top: 45px;">Instável</h4>`
                } else {
                    id_status_temperatura.innerHTML = `<h4 style="color:red; margin-top: 45px;">Emergência</h4>`
                }

                if(umidade >= 50) {
                    id_status_umidade.innerHTML = `<h4 style="color:#03F44E; margin-top: 45px;">Controlado</h4>`
                } else if(umidade >= 40) {
                    id_status_umidade.innerHTML = `<h4 style="color:yellow; margin-top: 45px;">Instável</h4>`
                } else {
                    id_status_umidade.innerHTML = `<h4 style="color:red; margin-top: 45px;">Emergência</h4>`
                }

            });
        });

    }

    function montarGauge(temperatura, umidade) {

        // fazer calculo para linkar o grafico de ponteiro
        if(temperatura >= 0 && temperatura <= 2) {
           temperatura *= 45
        } else if(temperatura > 2 && temperatura <= 4) {
            temperatura *= 37
        } else if(temperatura > 4 && temperatura <= 6) {
            temperatura *= 30
        } else {
            temperatura *= 26
        }

        /* if(umidade >= 0 && umidade <= 40) {
           temperatura *= 17.5
        } else if(umidade > 40 && umidade < 50) {
           
        } else {
           
        } */

        Highcharts.chart('container', {

            credits: {
                enabled: false
            },

            chart: {
                backgroundColor: null,
                type: 'gauge',
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false,
                height: '80%'
            },

            title: {
                style: {
                    color: '#FFFFFF',
                },
                text: 'Temperatura',
            },
            pane: {
                startAngle: -90,
                endAngle: 89.9,
                background: null,
                center: ['50%', '75%'],
                size: '150%'
            },

            // the value axis
            yAxis: {
                min: 0,
                max: 210,
                tickInterval: 52,
                tickPosition: 'inside',
                tickColor: '#000000',
                tickLength: 20,
                tickWidth: 1,
                tickPositions: [0, 30, 60, 90, 120, 150, 180, 210],
                minorTickInterval: null,
                width: '20px',
                labels: {
                    enabled: false,
                },
                lineWidth: 0,
                plotBands: [{
                    from: 0,
                    to: 90,
                    color: '#03F44E', // green
                    thickness: 13
                }, {
                    from: 150,
                    to: 210,
                    color: '#FF0000', // red
                    thickness: 13
                }, {
                    from: 90,
                    to: 150,
                    color: '#FFFF00', // yellow
                    thickness: 13
                }]
            },

            series: [{
                name: 'Speed',
                data: [temperatura],
                tooltip: {
                    valueSuffix: ' km/h'
                },
                dataLabels: {
                    format: '',
                    borderWidth: 0,
                    color: (
                        Highcharts.defaultOptions.title &&
                        Highcharts.defaultOptions.title.style &&
                        Highcharts.defaultOptions.title.style.color
                    ) || '#333333',
                    style: {
                        fontSize: '16px'
                    }
                },
                dial: {
                    radius: '80%',
                    backgroundColor: 'gray',
                    baseWidth: 12,
                    baseLength: '0%',
                    rearLength: '0%'
                },
                pivot: {
                    backgroundColor: 'gray',
                    radius: 6
                }

            }]

        });

        Highcharts.chart('container2', {

            credits: {
                enabled: false
            },

            chart: {
                backgroundColor: null,
                type: 'gauge',
                plotBackgroundImage: null,
                plotBorderWidth: 0,
                plotShadow: false,
                height: '80%'
            },

            title: {
                style: {
                    color: '#FFFFFF',
                },
                text: 'Umidade',
            },
            pane: {
                startAngle: -90,
                endAngle: 89.9,
                background: null,
                center: ['50%', '75%'],
                size: '150%'
            },

            // the value axis
            yAxis: {
                min: 0,
                max: 210,
                tickInterval: 52,
                tickPosition: 'inside',
                tickColor: '#000000',
                tickLength: 20,
                tickWidth: 1,
                tickPositions: [0, 30, 60, 90, 120, 150, 180, 210],
                minorTickInterval: null,
                width: '20px',
                labels: {
                    enabled: false,
                },
                lineWidth: 0,
                plotBands: [{
                    from: 0,
                    to: 90,
                    color: '#03F44E', // green
                    thickness: 13
                }, {
                    from: 150,
                    to: 210,
                    color: '#FF0000', // red
                    thickness: 13
                }, {
                    from: 90,
                    to: 150,
                    color: '#FFFF00', // yellow
                    thickness: 13
                }]
            },

            series: [{
                name: 'Speed',
                data: [210],
                tooltip: {
                    valueSuffix: ' km/h'
                },
                dataLabels: {
                    format: '',
                    borderWidth: 0,
                    color: (
                        Highcharts.defaultOptions.title &&
                        Highcharts.defaultOptions.title.style &&
                        Highcharts.defaultOptions.title.style.color
                    ) || '#333333',
                    style: {
                        fontSize: '16px'
                    }
                },
                dial: {
                    radius: '80%',
                    backgroundColor: 'gray',
                    baseWidth: 12,
                    baseLength: '0%',
                    rearLength: '0%'
                },
                pivot: {
                    backgroundColor: 'gray',
                    radius: 6
                }

            }]

        });

    }   

    buscarDadosReal()
    buscarDadosMes()

</script>