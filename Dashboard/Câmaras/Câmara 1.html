<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <link rel="icon" href="../Assets/Imagens/favicon.ico" type="image/x-icon">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
    <script src="../Funcionalidades.js"></script>
    <script src="../Gráficos.js"></script>
</head>

<body onclick="fecharPopup(); fecharAtualizacoes()">

    <!-- Sidebar -->
    <div class="headers">
        <section id="sidebar" class="sidebar">
            <img src="../assets/imagens/Ômega Fish.png" alt="">


            <li class="bx bx-home-alt icon" onclick="window.location.href = '../DashboardHome.html';">
                <span class="texto">Dashboard</span>
            </li>
            

            <li class="bx bx-notepad"> <span class="texto">Comunicados</span> </li>
            <li class="bx bx-cog"> <span class="texto">Configurações</span> </li>
            <li class="bx bx-refresh" onclick="exibirAtualizacoes(); event.stopPropagation();"> <span class="texto">Atualizações</span> </li>

            <div class="sidebar-end">
                <li class="bx bx-user-circle"> <span class="texto">Logout</span></li>
                <li id="mode" class="bx bx-sun"> <span id="modeText" class="mode-text texto">Light Mode</span></li>
            </div>
        </section>
        <div id="corpo" class="corpo">
            <section class="header">
                <li id="toggle" class="bx bx-list-ul toggle"></li>
                <h3 style="white-space: nowrap;">Dashboard</h3>
                <h3>-</h3>
                <h3 style="white-space: nowrap;">Câmara 1</h3>
                <div class="header-end">
                    <li class='bx bx-search-alt-2'></li>
                    <li class='bx bx-bell' onclick="exibirPopup(); event.stopPropagation();"></li>

                    <li onclick="AtivarDesativarFS()" class='bx bx-fullscreen'></li>
                    <h3>Josh Burton</h3>
                    <li class='bx bx-cog settings'></li>
                </div>
            </section>
            <section id="conteudo" class="div_pai">
                
                <div class="primeira_div">
                    <div class="KPIS">
                        <div class="kpi1">
                            <div class="titulo">
                                <h1> <span style="color: #00C3FF;">Temperatura</span> em Tempo real</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/ferramenta-termometro.png " alt=""> <h2 id="mensagem_temperatura"> -2C°</h2></div>
                        
                        </div>
                        <div class="kpi2">
                            <div class="titulo">
                                <h1><span style="color: #00C3FF;">Umidade</span> em Tempo real</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/agua.png " alt=""> <h2 id="mensagem_umidade"> 65%</h2></div>
                        </div>
                        <div class="kpi3">
                            <div class="titulo">
                                <h1><span style="color: #00C3FF;">Último</span> Alerta Registrado</h1>
                            </div>
                            <div class="digital"><img src="../assets/imagensdash/relogio.png " alt=""> <h2 id="mensagem_tempo"> 5 Dias</h2></div>
                        </div>
                    </div>
                    <div class="conteudo">
                        <div class="container">
                            <div class="tab">
    
                                <div class="header_tab">
                                    <div class="titulo">
                                        <h3>Temperatura</h3>
                                    </div>
    
                                    <div class="botões">
                                        <button class="tablinks active primeiro_botao"
                                            onclick="openTab(event, 'chartTab1')">Tempo Real</button>
                                        <button class="tablinks" onclick="openTab(event, 'chartTab2')">Última
                                            Semana</button>
                                        <button class="tablinks ultimo_botao" onclick="openTab(event, 'chartTab3')">Último
                                            Mês</button>
                                    </div>
                                </div>
    
    
                                <div id="chartTab1" class="tabcontent" style="display: block;">
                                    <canvas id="Temp_TempoReal"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Segundos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab2" class="tabcontent">
                                    <canvas id="Temp_Semana"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Semanas)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab3" class="tabcontent">
                                    <canvas id="Temp_Mes"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Mês)</span>
                                    </div>
                                </div>
    
                            </div>
                        </div>
    
                        <div class="container">
    
                            <div class="tab">
                                <div class="header_tab">
                                    <div class="titulo">
                                        <h3>Umidade</h3>
                                    </div>
    
                                    <div class="botões">
                                        <button class="tablinks2 active primeiro_botao"
                                            onclick="openTab2(event, 'chartTab4')">Tempo Real</button>
                                        <button class="tablinks2" onclick="openTab2(event, 'chartTab5')">Última
                                            Semana</button>
                                        <button class="tablinks2 ultimo_botao" onclick="openTab2(event, 'chartTab6')">Último
                                            Mês</button>
                                    </div>
                                </div>
    
    
    
                                <div id="chartTab4" class="tabcontent2" style="display: block;">
                                    <canvas id="Umid_TempoReal"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Segundos)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab5" class="tabcontent2">
                                    <canvas id="Umid_Semana"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Semanas)</span>
                                    </div>
                                </div>
    
                                <div id="chartTab6" class="tabcontent2">
                                    <canvas id="Umid_Mes"></canvas>
                                    <div class="legenda-x">
                                        <span>Tempo (Mês)</span>
                                    </div>
                                </div>
                                
    
                            </div>
                        </div>
                        
                    </div>
                    <div class="ultimo_grafico">
                        <div class="titulo">
                            <h1>Temperatura e Umidade Ao Longo do Ano </h1>
                        </div>
                        <canvas id="ultimo_grafico" width="900" height="200"></canvas>
                      </div>
                      
                      
                        
                      
                
                </div>
                <div class="segunda_div">
                    <div class="div_pai_container">

                
                        <div class="chartCard1">
                            <div class="container_chart">
                                <div class="chartBox">
                                    <div class="titulo">
                                        <h1>Medidor de Atividades <spans style="color: #00C3FF;">Críticas</spans></h1>
                                        <h1>Temperatura</h1>
                                    </div>
                                        

                                  <canvas id="myChart"></canvas>
                                  <div class="titulo_chart">
                                    <h3 id="id_status_temperatura"></h3>
                                </div>
                                <div class="descricao_chart">
                                    <h5 style="color: #03F44E;">&#x2B24; Controlado </h5>
                                    <h5 style="color: yellow;">&#x2B24; Instável</h5>
                                    <h5 style="color: red;">&#x2B24; Emergência</h5>
                                </div>
                                <div class="legenda_chart">
                                    <h5 style="color: #03F44E;">0°C ~ 2°C </h5> 
                                    <h5 style="color: yellow;"> 2°C ~ 4°C </h5> 
                                    <h5 style="color: red;">4°C ~ 8°C</h5>
                                </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="chartCard2">
                            <div class="container_chart">
                    
                                <div class="chartBox">
                                    <div class="titulo">
                                        <h1>Medidor de Atividades <span style="color: #00C3FF;">Críticas</span></h1>
                                        <h1>Umidade</h1>
                                    </div>
                                  <canvas id="myChart2"></canvas>
                                  <div class="titulo_chart">
                                    <h3 id="id_status_umidade"></h3>
                                </div>
                                <div class="descricao_chart">
                                    <h5 style="color: #03F44E; ">&#x2B24; Controlado </h5>
                                    <h5 style="color: yellow;">&#x2B24; Instável</h5>
                                    <h5 style="color: red;">&#x2B24; Emergência</h5>
                                </div>
                                <div class="legenda_chart2">
                                    <h5 style="color: #03F44E;">100% ~ 50% </h5> 
                                    <h5 style="color: yellow;"> 50% ~ 40% </h5> 
                                    <h5 style="color: red;">40% ~ 0%</h5>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                    
                
                
            </section>

        </div>


    </div>
    <div id="popup" class="popup">
        <h2>Notificações</h2>
        <p>Suas notificações aparecerão aqui...</p>
    </div>
    <div id="atualizacoes" class="atualizacoes">
        <h2>Atualizações</h2>
        <p>Ainda não tivemos nenhuma atualização...</p>
    </div>

</body>

</html>

<script>

    mensagem_temperatura.innerHTML = `${temperatura}°C`
    mensagem_umidade.innerHTML = `${umidade}%`
    mensagem_tempo.innerHTML = `${tempo} ${unidade_tempo}`

    if(temperatura <= 2) {
        id_status_temperatura.innerHTML = `<h4 style="color:#03F44E">Controlado</h4>`
    } else if(temperatura <= 4) {
        id_status_temperatura.innerHTML = `<h4 style="color:yellow">Instável</h4>`
    } else {
        id_status_temperatura.innerHTML = `<h4 style="color:red">Emergência</h4>`
    }
    if(umidade >= 50) {
        id_status_umidade.innerHTML = `<h4 style="color:#03F44E">Controlado</h4>`
    } else if(umidade >= 40) {
        id_status_umidade.innerHTML = `<h4 style="color:yellow">Instável</h4>`
    } else {
        id_status_umidade.innerHTML = `<h4 style="color:red">Emergência</h4>`
    }

    

    const ctx7 = document.getElementById('ultimo_grafico');

    new Chart(ctx7, {
        type: 'line',
        data: {

            labels: ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],

            datasets: [{
                label: 'Umidade',
                data: [52, 53, 53, 53, 52, 52, 53, 52, 53, 52, 53, 53],
                borderColor: 'rgb(0, 195, 255)',
                backgroundcolor: 'rgb(13, 14, 43)',
                lineTension: 0.3,
                yAxisID: 'y',
                
            },
            {
                label: 'Temperatura',
                data: [0, 1, 0.7, 1.5, 1, 1, 1.5, 1, 0.5, 0, 0.5, 0.8],
                borderColor: 'rgb(255, 151, 46)',
                backgroundcolor: 'rgb(13, 14, 43)',
                lineTension: 0.3,
                yAxisID: 'y1',
            }

            ]
        },
        options: {
            
            scales: {
                y: {
                    ticks: {
                        callback: function (value, index, values) {
                            return value + '%'; // Adiciona o símbolo de porcentagem
                        },
                        padding: 15
                    },
                    position: 'left',
                    grid: {
                        color: 'rgb(65, 65, 65)', // Cor das linhas de grade do eixo y
                    },
                    yAxisID: 'y',
                },

                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: {
                        color: 'rgb(65, 65, 65)', // Cor das linhas de grade do eixo y
                    },
                    yAxisID: 'y1',
                }
                ,

                x: {
                    grid: {
                        color: 'rgb(65, 65,65)', // Cor das linhas de grade do eixo x
                    }
                }
            }
        }
    });
    // setup 
    const data = {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'Weekly Sales',
            data: [15, 15, 15, 15, 15, 15, 15],
            backgroundColor: [
            '#03F44E', //verde
            '#03F44E', //verde
            '#03F44E', //verde
            'rgba(255, 255, 0)', //amarelo
            'rgba(255, 255, 0)', //amarelo
            'rgba(255, 0, 0)', //vermelho
            'rgba(255, 0, 0)', //vermelho


            ],
            borderColor: [
                'rgba(0, 0, 0)', //vermelho
                'rgba(0, 0, 0)', //amarelo
                'rgba(0, 0, 0)', //verde
                'rgba(0, 0, 0)', //amarelo
                'rgba(0, 0, 0)', //vermelho
            ],
            borderWidth: 1,
            circumference: 180,
            rotation: 270,
            cutout: '80%',
            needleValue: temperatura_gauge * 18
        }]
    };
    const gaugeNeedle = {
        id: 'gaugeNeedle',
        afterDatasetsDraw(chart, args, plugins) {
            const { ctx, data } = chart;

            ctx.save();
            const xCenter = chart.getDatasetMeta(0).data[0].x;
            const yCenter = chart.getDatasetMeta(0).data[0].y;
            const outerRadius = chart.getDatasetMeta(0).data[0].outerRadius;
            const innerRadius = chart.getDatasetMeta(0).data[0].innerRadius;
            const widthSlice = (outerRadius - innerRadius) / 2;
            const radius = outerRadius / 10; // Ajuste o tamanho do ponteiro aqui (por exemplo, 1/10 do raio externo)
            const angle = Math.PI / 180

            const needleValue = data.datasets[0].needleValue;

            const dataTotal = data.datasets[0].data.reduce((a, b) => a + b, 0);

            const circumference = ((chart.getDatasetMeta(0).data[0].circumference / Math.PI) / data.datasets[0].data[0]) * needleValue;

            ctx.translate(xCenter, yCenter);
            ctx.rotate(Math.PI * (circumference + 1.5));

            ctx.beginPath();

            ctx.strokeStyle = 'black';
            ctx.fillStyle = 'grey'
            ctx.lineWidth = 1;


            ctx.moveTo(0 - radius, 0);
            ctx.lineTo(0, 0 - innerRadius - widthSlice);
            ctx.lineTo(0 + radius, 0);

            ctx.closePath();
            ctx.stroke();
            ctx.fill();

            //círculo no meio

            ctx.beginPath();
            ctx.arc(0, 0, radius, 0, angle * 360, false);
            ctx.fill();
            ctx.restore();
        }
    }
    // gaugeFlowMeter plugin block
    const gaugeFlowMeter = {
        id: 'gaugeFlowMeter',
        afterDatasetsDraw(chart, args, plugins) {
            const { ctx, data } = chart;

            ctx.save();
            const needleValue = data.datasets[0].needleValue;
            const xCenter = chart.getDatasetMeta(0).data[0].x;
            const yCenter = chart.getDatasetMeta(0).data[0].y;

            const circumference = ((chart.getDatasetMeta(0).data[0].circumference / Math.PI) / data.datasets[0].data[0]) * needleValue;
            const percentageValue = circumference * 100;

            // flowMeter
            ctx.font = 'bold 30px sans-serif';
            ctx.fillStyle = 'grey';
            ctx.textAlign = 'center';
            ctx.fillText(`${percentageValue.toFixed(1)}%`, xCenter, yCenter + 45);

        }
    }
    // config 
    const config = {
        type: 'doughnut',
        data,
        options: {
            layout: {
                padding: {
                    bottom: 50
                }
            },
            aspectRatio: 1.7,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: false
                }
            }
        },
        plugins: [gaugeNeedle]
    };

    // render init block
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );
    function createGaugeChart2(canvasId, needleValue2) {
        const data2 = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Weekly Sales',
                data: [15, 15, 15, 15, 15, 15, 15],
                backgroundColor: [
                    '#03F44E',
                    '#03F44E',
                    '#03F44E',
                    'rgba(255, 255, 0)',
                    'rgba(255, 255, 0)',
                    'rgba(255, 0, 0)',
                    'rgba(255, 0, 0)',
                ],
                borderColor: [
                    'rgba(0, 0, 0)',
                    'rgba(0, 0, 0)',
                    'rgba(0, 0, 0)',
                    'rgba(0, 0, 0)',
                    'rgba(0, 0, 0)',
                ],
                borderWidth: 1,
                circumference: 180,
                rotation: 270,
                cutout: '80%',
                needleValue: (umidade_gauge - 95) * -1
            }]
        };

        const gaugeNeedle2 = {
            id: 'gaugeNeedle2',
            afterDatasetsDraw(chart, args, plugins) {
                const { ctx, data } = chart;

                ctx.save();
                const xCenter = chart.getDatasetMeta(0).data[0].x;
                const yCenter = chart.getDatasetMeta(0).data[0].y;
                const outerRadius = chart.getDatasetMeta(0).data[0].outerRadius;
                const innerRadius = chart.getDatasetMeta(0).data[0].innerRadius;
                const widthSlice = (outerRadius - innerRadius) / 2;
                const radius = outerRadius / 10;
                const angle = Math.PI / 180

                const needleValue = data.datasets[0].needleValue;

                const dataTotal = data.datasets[0].data.reduce((a, b) => a + b, 0);

                const circumference = ((chart.getDatasetMeta(0).data[0].circumference / Math.PI) / data.datasets[0].data[0]) * needleValue;

                ctx.translate(xCenter, yCenter);
                ctx.rotate(Math.PI * (circumference + 1.5));

                ctx.beginPath();

                ctx.strokeStyle = 'black';
                ctx.fillStyle = 'grey'
                ctx.lineWidth = 1;


                ctx.moveTo(0 - radius, 0);
                ctx.lineTo(0, 0 - innerRadius - widthSlice);
                ctx.lineTo(0 + radius, 0);

                ctx.closePath();
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, angle * 360, false);
                ctx.fill();
                ctx.restore();
            }
        };

        const config2 = {
            type: 'doughnut',
            data: data2,
            options: {
                layout: {
                    padding: {
                        bottom: 50
                    }
                },
                aspectRatio: 1.7,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: false
                    }
                }
            },
            plugins: [gaugeNeedle2]
        };

        return new Chart(
            document.getElementById(canvasId),
            config2
        );
    }

    const myChart22 = createGaugeChart2('myChart2');

</script>